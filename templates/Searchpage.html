<!DOCTYPE html>
<html>
<head>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src='https://kit.fontawesome.com/a076d05399.js'></script>
<script src="https://kryogenix.org/code/browser/sorttable/sorttable.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js"></script>
    <script src="https://cdn.anychart.com/releases/v8/js/anychart-tag-cloud.min.js"></script>

</head>
<style>
.w3-theme-blue {color:#fff !important;background-color: #bcccfe !important}

.w3-theme-l3 {color:#fff !important; background-color: #2b2b2b !important}
.w3-theme-l2 {color:#fff !important; background-color: #5d6264 !important}
.bluey {color:#fff !important; background-color: #64bfe4 !important}
.pinky {color:#fff !important;background-color: #cb74a7 !important}
.bluegreeny {color:#fff !important; background-color: #5da8a2 !important}
.darkpurpley {color:#fff !important; background-color: #3d3479 !important}

body, h1,h2,h3,h4,h5,h6 {font-family: "Montserrat", sans-serif}
.w3-row-padding img {margin-bottom: 12px}
/* Set the width of the sidebar to 120px */
.w3-sidebar {width: 120px;background: #2b2b2b;}
/* Add a left margin to the "page content" that matches the width of the sidebar (120px) */
#main {margin-left: 120px}
/* Remove margins from "page content" on small screens */

table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}
td,
th {
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #ddd;
}
.textarea{
  width:100%;
  overflow:hidden;
  height:150px;
  max-height:150px;
  border:1px solid #ccc;
  overflow-y: auto;
}

/* The scrollable part */

.scrollable {
  min-height: 100px;
  max-height: 300px;
  width: 100%;
  overflow-y: scroll;
  border-bottom: 1px solid #ddd;
}

th {
  position: sticky;
  background-color: white;
  z-index: 2;
  top: 0;
}
</style>
<body class="w3-theme-l2">

<!-- Icon Bar (Sidebar - hidden on small screens) -->
<nav class="w3-sidebar w3-card-4 w3-bar-block w3-small w3-hide-small w3-center ">
  <!-- Avatar image in top left corner -->
  <img src="../static/caticon.gif" style="width:100%" alt="icon">
  <a href='{{ url_for('hello_world') }}' class="w3-round-xlarge w3-wide w3-opacity-min w3-bar-item w3-button w3-padding-large w3-topbar w3-bottombar  w3-border-white bluegreeny w3-hover-white w3-section">
    <i class="fa fa-home w3-xxlarge"></i>
    <p>HOME</p>
  </a>
    <a href='{{ url_for('results') }}' class="w3-round-xlarge w3-wide w3-bar-item w3-button w3-padding-large w3-topbar w3-bottombar  w3-border-white bluey w3-hover-white w3-section">
    <i class="fa fa-search w3-xxlarge"></i>
    <p>SEARCH</p>
  </a>

</nav>

<!-- Navbar on small screens (Hidden on medium and large screens) -->
<div class="w3-top w3-hide-large w3-hide-medium" id="myNavbar">
  <div class="w3-bar w3-theme-l3 w3-hover-opacity-off w3-opacity-min w3-center w3-small">
    <a href='{{ url_for('hello_world') }}' class="w3-bar-item bluegreeny w3-button w3-text-white" style="width:25% !important">HOME</a>

    <a href='{{ url_for('results') }}' class="w3-bar-item w3-button bluey w3-text-white" style="width:25% !important">SEARCH</a>
  </div>
</div>

<!-- Page Content -->
<div class="w3-padding-large" id="main">
  <!-- Header/Home -->
  <header class="w3-card w3-padding-32 w3-center w3-theme-l3" id="home">
      <span class="w3-hide-small"></span>  <div class=" bluegreeny w3-round-xlarge w3-margin"><h1 class=" w3-margin" style="font-size: 55px">PUBMED SEARCH</h1></div>
    <p>For easy up to date information</p>
  </header>

 <!-- FORM -->
    <div class="w3-card-4 w3-white w3-section">
  <div class="w3-container w3-theme-l3 w3-padding">
      <div class="w3-panel bluey w3-round-xlarge" style="width: 10%;"><h2 class="w3-wide" style="font-size: 30px;">Search</h2></div>
  </div>
  <form class="w3-container " method="post" action="https://hannl-hlo-bi2a1-app.azurewebsites.net/result">
    <p>
    <label class="w3-text-black"><b>disease-characteristics</b></label>
    <input placeholder="Searchterm1 , Searchterm2" class="w3-input w3-border w3-white" name="disease_characteristic" type="text" required></p>
    <p>
    <label class="w3-text-black"><b>Specified Organism</b></label>
    <input placeholder="Mouse (*optional)" class="w3-input w3-border w3-white" name="organism" type="text">
    <p>
    <label class="w3-text-black"><b>E-mail</b></label>
    <input  placeholder="Your.Name.Here@example.org" class="w3-input w3-border w3-white" name="mail" type="text" pattern="\S+@\S+" required></p>
    <p>
      <p><label class="w3-text-black"><b>Gene List</b></label></p>
        <p>
            <label>
            <textarea placeholder="Gene1 &#10;Gene2&#10;Gene3 &#10;etc.."
                      name="gene_list" style="width: 100%"></textarea>
            </label>
        </p>
    <div class="w3-row-padding">
        <div class="w3-third">
    <select class="w3-select w3-section w3-cell" name="publication_date">
      <option value="" disabled selected>Choose max publication date</option>
      <option value="3">3 Months</option>
      <option value="6">6 Months</option>
      <option value="9">9 Months</option>
      <option value="12">1 Year</option>
      <option value="24">2 Years</option>
    </select>
        </div>
        <div class="w3-third">
        <select class="w3-select w3-section w3-cell" name="amount_articles" required>
            <option value="" disabled selected>How many articles to retrieve</option>
            <option value=5000> 100000</option>
            <option value=10000> 100000</option>
            <option value=25000> 100000</option>
            <option value=50000> 100000</option>
            <option value=100000> 100000</option>
            <option value=200000> 200000</option>
            <option value=300000> 300000</option>
            <option value=400000> 400000</option>
            <option value=500000> 500000</option>
        </select>
        </div>
    </div>
    <p>
        <button class="w3-btn bluey w3-round-xlarge w3-large w3-text-white" style="width: 10%"><b>Search</b>  <i class="fa fa-search w3-large"></i></button></p>
  </form>
</div>
     <!--  end FORM -->
 <!-- start Results  link to pubmed article https://www.ncbi.nlm.nih.gov/pubmed/?term= item.pubmedId-->
    <div class="w3-card-4 w3-white w3-section">
  <div class="w3-container w3-theme-l3">
      <div class="w3-panel pinky w3-round-xlarge" style="width: 10%"> <h2 class="w3-wide">Results</h2></div>
  </div>
    <div class=" w3-container w3-cell-row w3-section w3-white" style="height: 300px;width: 100%">
        {% if plot != None and recipe_dict != None%}
        <div class="w3-container w3-cell w3-margin" style="width: 100%; height: 380px" >
            <div id="chartContainer" style="height: 370px; max-width: 920px; margin: 5px auto;"></div>
            <button class="w3-btn w3-wide w3-round-xlarge pinky w3-text-white invisible" id="backButton">< Back</button>
            <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
            <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
        </div>
        <div class=" w3-container " style="width: 100%; height: 380px">
            <div class="scrollable w3-margin" style="width: 100%">
              <table class="sortable w3-table-all w3-text-black">
                <tr>
                  <th>Gene</th>
                  <th>Amount of Articles</th>
                </tr>
                  {% for gene_name, value in recipe_dict.items() %}
                <tr>
                  <td>{{ gene_name }}</td>
                  <td>{{ value }}</td>
                </tr>
                  {% endfor %}
              </table>
            </div>
        </div>
        {% endif %}
    </div>
        {% if"articles" in genedic.keys() %}
     {% for name, gene in genedic["articles"].items()%}

         <div class = "w3-card w3-white, w3-margin">


             <button onclick="myFunction('{{name }}')" class="w3-button w3-block w3-theme-l2 w3-round-xlarge w3-left-align">
                 {{ name }}  <i class='fas fa-angle-down'></i> </button>
            <div id="{{name }}" class="w3-container w3-hide w3-border">
        {%for omim_name, omim_id in genedic["omim_id"].items() %}
        {%if name == omim_name %}
            <div class="w3-card">

            <a href="https://omim.org/entry/{{omim_id[0] }}"  target="_blank">
            <button class="w3-button w3-white w3-border w3-wide w3-margin" style="width: 30%">OMIM</button>
            </a>
            <a href="https://www.uniprot.org/uniprot/{{omim_id[1] }}"  target="_blank">
            <button class="w3-button w3-white w3-border w3-wide w3-margin" style="width: 30%">UNIPROT</button>
            </a>
            <a href="https://www.ncbi.nlm.nih.gov/gene/{{omim_id[2] }}"  target="_blank">
            <button class="w3-button w3-white w3-border w3-wide w3-margin" style="width: 30%">NCBI</button>
            </a>
            </div>
              {%endif %}
        {%endfor %}
              <ul class="w3-ul">
                {% for genename , list in gene.items() %}
                    <li class="w3-theme-l2 w3-section w3-round-large"> <b>{{ genename }}</b> </li>
                    {% for item in list %}
                        <li>
                        <div class="w3-bar w3-light">
                            <div class=" w3-button w3-left"><a href="https://www.ncbi.nlm.nih.gov/pubmed/?term={{ item.pubmedID }}" target="_blank">{{item.getTitle()}}</a></div>
                        <div class="w3-button w3-right w3-border w3-opaque" onclick="document.getElementById({{ item.pubmedID }}).style.display='block'"> more info</div>
                        </div>
                        </li>
                    {% endfor %}
                {% endfor %}
              </ul>
            </div>
         </div>
     {% endfor %}
    {% endif %}
    </div>

{% for id, dic in infodic.items() %}
    <div id={{ id }} class="w3-modal" >
    <div class="w3-modal-content" style="width: 50%">
      <div class="w3-container w3-theme-l3">
        <span onclick="document.getElementById('{{ id }}').style.display='none'" class="w3-button w3-display-topright">&times;</span>
        <!-- Code for modal in here-->
          <div class="w3-container w3-theme-l3 w3-section">
              <div class="w3-panel darkpurpley w3-round-xlarge w3-wide"><p> {{ entries[id].getTitle() }} </p></div>
          </div>
            <h5 class="w3-wide" >Abstract: </h5>
          <div class="textarea">
              <p> {{ entries[id].getAbout() }}</p>
          </div>
          <div class="w3-cell-row w3-margin" style="width:100%">
          <div class="w3-container w3-cell w3-margin w3-border">
          {% for name, list in dic.items()%}
              {% if name != id %}
            <button onclick="myFunction('{{ id+name }}')" class=" w3-wide w3-button w3-round-xlarge w3-block w3-left-align darkpurpley w3-margin-top">
            {{ name }}  <i class='fas fa-angle-down'></i></button>
            <div id="{{ id+name }}" class="w3-container w3-hide">
                {% for value in list %}
                <p>{{ value }}</p>
                {% endfor %}
            </div>
              {% endif %}
          {% endfor %}
      </div>
           {% if data %}
      <div class="container w3-margin w3-cell-middle w3-border">
      <div id="{{ id }}" ></div>
      </div>
          {% endif %}
          </div>
      </div>
    </div>
  </div>
{% endfor %}
</div>
<script>
function myFunction(id) {
    const x = document.getElementById(id);
    if (x.className.indexOf("w3-show") === -1) {
    x.className += " w3-show";
  } else {
    x.className = x.className.replace(" w3-show", "");
  }
}
</script>

<script>
window.onload = function () {

var visitorsData = {
	"Articles per gene": [{
		click: visitorsChartDrilldownHandler,
		cursor: "pointer",
		explodeOnClick: false,
		innerRadius: "50%",
		name: "New vs Returning Visitors",
		radius: "100%",
        legend: {
		    horizontalAlign: "left", // left, center ,right
            verticalAlign: "center",  // top, center, bottom
        },
		startAngle: 90,
		type: "doughnut",
		dataPoints: [
		    {% for key, value in recipe_dict.items()%}
                { y: {{value}}, name: "{{key}}"} ,
            {% endfor %}

		]
	}],
    {% if 'articles' in genedic.keys() %}
    {% for key, value in genedic['articles'].items() %}
	"{{ key }}": [{
		color: "#5be7bf",
		name: "{{ key }}",
		type: "column",
		dataPoints: [
            {% for genething, article_list in value.items() %}
                {% for idk in article_list %}
			    { label: '{{ idk.getTitle() }}', y: {{ idk.getScore() }} },
                {% endfor %}
            {% endfor %}
		]
	}],
    {% endfor %}
    {% endif %}

};

var newVSReturningVisitorsOptions = {
	animationEnabled: true,
	theme: "light2",
    legend: {
	    horizontalAlign: "left",
        verticalAlign: "center"
    },
	title: {
		text: "Amount of Articles per gene"
	},
	subtitles: [{
		text: "Click on Any Segment to see scores per article",
		backgroundColor: "#2eacd1",
		fontSize: 16,
		fontColor: "white",
		padding: 5
	}],
	data: []
};

var visitorsDrilldownedChartOptions = {
	animationEnabled: true,
	theme: "light2",
	axisX: {
        valueFormatString: " ",
		labelFontColor: "#717171",
		lineColor: "#a2a2a2",
		tickColor: "#a2a2a2"
	},
	axisY: {
		gridThickness: 0,
		includeZero: false,
		labelFontColor: "#717171",
		lineColor: "#a2a2a2",
		tickColor: "#a2a2a2",
		lineThickness: 1
	},
	data: []
};

var chart = new CanvasJS.Chart("chartContainer", newVSReturningVisitorsOptions);
chart.options.data = visitorsData["Articles per gene"];
chart.render();

function visitorsChartDrilldownHandler(e) {
	chart = new CanvasJS.Chart("chartContainer", visitorsDrilldownedChartOptions);
	chart.options.data = visitorsData[e.dataPoint.name];
	chart.options.title = { text: e.dataPoint.name };
	chart.render();
	$("#backButton").toggleClass("invisible");
}

$("#backButton").click(function() {
	$(this).toggleClass("invisible");
	chart = new CanvasJS.Chart("chartContainer", newVSReturningVisitorsOptions);
	chart.options.data = visitorsData["Articles per gene"];
	chart.render();
});

}
</script>
<script>
        anychart.onDocumentReady(function() {
            {% for id, list in data.items() %}
          var data = [
              {% for line in list %}
            {"x": "{{ line[0] }}", "value": {{ line[1] }}, category: "{{ line[2] }}"},
              {% endfor %}
          ];

         // create a tag (word) cloud chart
          var chart = anychart.tagCloud(data);
           // set a chart title
          chart.title('Frequency of words in article \n hover over to see more info');
          // set an array of angles at which the words will be laid out
          chart.angles([0]);
          // enable a color range
          var stage = anychart.graphics.create("{{ id }}");
          chart.colorRange(true);
          // set the color range length
          chart.colorRange().length('80%');
          chart.bounds("25%", 0, "49%", "49%");
          chart.background({fill: "#2b2b2b 1.0"});
          // display the word cloud chart
          chart.container(stage).draw();
            {% endfor %}
        });
    </script>
</body>
</html>